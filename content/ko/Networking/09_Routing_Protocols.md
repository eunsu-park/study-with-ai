# 라우팅 프로토콜

## 개요

이 문서에서는 동적 라우팅 프로토콜의 종류와 특징을 다룹니다. RIP, OSPF, BGP 등 주요 라우팅 프로토콜의 동작 원리를 이해하고, 각 프로토콜이 적합한 환경을 학습합니다.

**난이도**: ⭐⭐⭐
**예상 학습 시간**: 3-4시간
**선수 지식**: [08_Routing_Basics.md](./08_Routing_Basics.md)

---

## 목차

1. [라우팅 프로토콜 분류](#1-라우팅-프로토콜-분류)
2. [거리 벡터 vs 링크 상태](#2-거리-벡터-vs-링크-상태)
3. [RIP (Routing Information Protocol)](#3-rip-routing-information-protocol)
4. [OSPF (Open Shortest Path First)](#4-ospf-open-shortest-path-first)
5. [BGP (Border Gateway Protocol)](#5-bgp-border-gateway-protocol)
6. [AS (Autonomous System)](#6-as-autonomous-system)
7. [연습 문제](#7-연습-문제)
8. [다음 단계](#8-다음-단계)
9. [참고 자료](#9-참고-자료)

---

## 1. 라우팅 프로토콜 분류

### 1.1 IGP vs EGP

라우팅 프로토콜은 사용 범위에 따라 IGP와 EGP로 분류됩니다.

```
                    라우팅 프로토콜 분류

┌─────────────────────────────────────────────────────────────────┐
│                          인터넷                                  │
│                                                                  │
│  ┌──────────────────┐          ┌──────────────────┐            │
│  │      AS 100      │   EGP    │      AS 200      │            │
│  │                  │◄────────►│                  │            │
│  │    (예: KT)      │   BGP    │   (예: SKT)      │            │
│  │                  │          │                  │            │
│  │  ┌────┐ ┌────┐  │          │  ┌────┐ ┌────┐  │            │
│  │  │ R1 │─│ R2 │  │          │  │ R3 │─│ R4 │  │            │
│  │  └────┘ └────┘  │          │  └────┘ └────┘  │            │
│  │       IGP       │          │       IGP       │            │
│  │   (OSPF/RIP)    │          │   (OSPF/RIP)    │            │
│  └──────────────────┘          └──────────────────┘            │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

| 구분 | IGP (Interior Gateway Protocol) | EGP (Exterior Gateway Protocol) |
|------|--------------------------------|--------------------------------|
| 사용 범위 | AS 내부 | AS 간 |
| 목적 | 내부 네트워크 최적 경로 | 외부 네트워크 연결 정책 |
| 프로토콜 | RIP, OSPF, EIGRP, IS-IS | BGP |
| 메트릭 | 홉 수, 대역폭, 지연 등 | 경로 속성 (Path Attributes) |

### 1.2 알고리즘에 따른 분류

```
┌─────────────────────────────────────────────────────────────────┐
│                   라우팅 알고리즘 분류                           │
├───────────────────────────┬─────────────────────────────────────┤
│      거리 벡터            │           링크 상태                  │
│   (Distance Vector)       │        (Link State)                 │
├───────────────────────────┼─────────────────────────────────────┤
│ • RIP                     │ • OSPF                              │
│ • EIGRP (하이브리드)      │ • IS-IS                             │
│                           │                                     │
│ 특징:                     │ 특징:                               │
│ - 이웃과 정보 교환        │ - 전체 토폴로지 파악                │
│ - Bellman-Ford 알고리즘   │ - Dijkstra 알고리즘                 │
│ - 단순, 적은 리소스       │ - 복잡, 많은 리소스                 │
│ - 수렴 느림               │ - 수렴 빠름                         │
└───────────────────────────┴─────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                      경로 벡터                                   │
│                   (Path Vector)                                  │
├─────────────────────────────────────────────────────────────────┤
│ • BGP                                                           │
│                                                                  │
│ 특징:                                                           │
│ - AS 경로 정보 전달                                             │
│ - 정책 기반 라우팅                                              │
│ - 인터넷 백본에서 사용                                          │
└─────────────────────────────────────────────────────────────────┘
```

### 1.3 클래스풀 vs 클래스리스

| 구분 | 클래스풀 | 클래스리스 |
|------|---------|-----------|
| 서브넷 마스크 | 전송 안 함 | 함께 전송 |
| VLSM 지원 | X | O |
| CIDR 지원 | X | O |
| 프로토콜 | RIPv1, IGRP | RIPv2, OSPF, EIGRP, BGP |

---

## 2. 거리 벡터 vs 링크 상태

### 2.1 거리 벡터 (Distance Vector)

"내 이웃이 알려준 정보를 믿는다"

```
                    거리 벡터 동작 방식

초기 상태:
    R1 ─── R2 ─── R3 ─── R4
   [A]    [ ]    [ ]    [D]

Step 1: 이웃에게 라우팅 테이블 광고
    R1: "A까지 거리 0"  ──►  R2
    R4: "D까지 거리 0"  ──►  R3

Step 2: 받은 정보 + 1 (홉 카운트)
    R2: "A까지 거리 1" (via R1)
    R3: "D까지 거리 1" (via R4)

Step 3: 다시 이웃에게 광고
    R2: "A까지 거리 1"  ──►  R3
    R3: "D까지 거리 1"  ──►  R2

Step 4: 최종 수렴
    R1: A(0), D(3)
    R2: A(1), D(2)
    R3: A(2), D(1)
    R4: A(3), D(0)
```

**장점**:
- 구현이 간단
- 적은 CPU/메모리 사용
- 소규모 네트워크에 적합

**단점**:
- 수렴 시간이 느림
- 라우팅 루프 가능성
- 홉 수 제한 (RIP: 15)

### 2.2 링크 상태 (Link State)

"나 자신이 전체 네트워크를 파악한다"

```
                    링크 상태 동작 방식

네트워크 토폴로지:
         10          5           15
    R1 ────── R2 ────── R3 ────── R4
     │                            │
     └────────────────────────────┘
                  20

Step 1: 각 라우터가 LSA(Link State Advertisement) 생성
    R1의 LSA: "R1 연결: R2(비용10), R4(비용20)"
    R2의 LSA: "R2 연결: R1(비용10), R3(비용5)"
    ...

Step 2: LSA를 모든 라우터에 플러딩
    모든 라우터가 동일한 LSDB(Link State Database) 보유

Step 3: Dijkstra 알고리즘으로 최단 경로 계산
    R1 → R4 경로:
    - R1 → R4 직접: 비용 20
    - R1 → R2 → R3 → R4: 비용 10+5+15 = 30
    선택: 직접 경로 (비용 20)
```

**SPF (Shortest Path First) 트리 예시**:

```
R1의 SPF 트리:

                R1 (루트)
               /   \
         (10) /     \ (20)
             /       \
           R2        R4
           |
      (5)  |
           |
          R3
           |
     (15)  |
           |
          R4 (중복 - 비용 높음, 무시)
```

**장점**:
- 빠른 수렴
- 정확한 토폴로지 정보
- 라우팅 루프 없음
- VLSM/CIDR 지원

**단점**:
- 높은 CPU/메모리 요구
- 복잡한 설정
- 초기 플러딩으로 대역폭 소모

### 2.3 비교 요약

| 특성 | 거리 벡터 | 링크 상태 |
|------|----------|----------|
| 정보 공유 | 라우팅 테이블 | 링크 상태 (토폴로지) |
| 알고리즘 | Bellman-Ford | Dijkstra |
| 업데이트 | 주기적 (전체) | 변경 시 (변경분만) |
| 수렴 속도 | 느림 | 빠름 |
| 리소스 | 적음 | 많음 |
| 확장성 | 낮음 | 높음 |
| 대표 프로토콜 | RIP, EIGRP | OSPF, IS-IS |

---

## 3. RIP (Routing Information Protocol)

### 3.1 RIP 개요

RIP는 가장 오래된 거리 벡터 라우팅 프로토콜로, 단순하지만 제한적입니다.

```
┌─────────────────────────────────────────────────────────────────┐
│                       RIP 특징                                   │
├─────────────────────────────────────────────────────────────────┤
│  • 메트릭: 홉 카운트 (Hop Count)                                │
│  • 최대 홉: 15 (16 = 도달 불가)                                 │
│  • 업데이트 주기: 30초                                          │
│  • 관리 거리 (AD): 120                                          │
│  • 포트: UDP 520                                                │
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 RIP 버전 비교

| 특성 | RIPv1 | RIPv2 |
|------|-------|-------|
| 클래스 | 클래스풀 | 클래스리스 |
| 서브넷 마스크 | 미전송 | 전송 |
| VLSM | 미지원 | 지원 |
| CIDR | 미지원 | 지원 |
| 인증 | 없음 | 지원 (MD5) |
| 전송 방식 | 브로드캐스트 | 멀티캐스트 (224.0.0.9) |

### 3.3 RIP 동작 과정

```
RIP 라우팅 업데이트 예시

네트워크 구성:
    Network A          Network B          Network C
   10.0.0.0/24        10.1.0.0/24        10.2.0.0/24
       │                  │                  │
    ┌──┴──┐            ┌──┴──┐            ┌──┴──┐
    │ R1  │────────────│ R2  │────────────│ R3  │
    └─────┘            └─────┘            └─────┘

초기 라우팅 테이블:

R1:
┌────────────────┬──────┬───────────┐
│ 네트워크        │ 홉   │ 다음 홉   │
├────────────────┼──────┼───────────┤
│ 10.0.0.0/24    │ 0    │ 직접 연결  │
└────────────────┴──────┴───────────┘

30초 후 (R2가 R1, R3로부터 업데이트 수신):

R2:
┌────────────────┬──────┬───────────┐
│ 네트워크        │ 홉   │ 다음 홉   │
├────────────────┼──────┼───────────┤
│ 10.0.0.0/24    │ 1    │ R1        │
│ 10.1.0.0/24    │ 0    │ 직접 연결  │
│ 10.2.0.0/24    │ 1    │ R3        │
└────────────────┴──────┴───────────┘

60초 후 (수렴 완료):

R1:
┌────────────────┬──────┬───────────┐
│ 네트워크        │ 홉   │ 다음 홉   │
├────────────────┼──────┼───────────┤
│ 10.0.0.0/24    │ 0    │ 직접 연결  │
│ 10.1.0.0/24    │ 1    │ R2        │
│ 10.2.0.0/24    │ 2    │ R2        │
└────────────────┴──────┴───────────┘
```

### 3.4 RIP 타이머

| 타이머 | 값 | 설명 |
|--------|------|------|
| Update | 30초 | 라우팅 업데이트 전송 주기 |
| Invalid | 180초 | 경로가 무효로 표시되는 시간 |
| Holddown | 180초 | 경로 변경 방지 시간 |
| Flush | 240초 | 라우팅 테이블에서 삭제 시간 |

### 3.5 RIP 루프 방지 메커니즘

```
1. Split Horizon (스플릿 호라이즌)
   - 경로를 배운 인터페이스로 같은 경로 광고 금지

       R1 ──────── R2
       │
   "10.0.0.0을 R1에게서 배웠으니,
    R1에게 다시 10.0.0.0 광고 안 함"

2. Route Poisoning (라우트 포이즈닝)
   - 다운된 경로를 메트릭 16으로 광고

   R1: "10.0.0.0 다운됨"
   R1 → R2: "10.0.0.0 메트릭=16 (도달 불가)"

3. Holddown Timer (홀드다운 타이머)
   - 경로 다운 후 일정 시간 새 경로 수락 금지
   - 잘못된 정보 전파 방지

4. Triggered Update (트리거드 업데이트)
   - 변경 발생 시 즉시 업데이트 전송
   - 30초 대기 없이 빠른 수렴
```

### 3.6 RIP 설정 예시

**Cisco Router**:
```
Router(config)# router rip
Router(config-router)# version 2
Router(config-router)# network 10.0.0.0
Router(config-router)# network 192.168.1.0
Router(config-router)# no auto-summary
```

**Linux (Quagga/FRR)**:
```
router rip
 version 2
 network 10.0.0.0/8
 network 192.168.1.0/24
 no auto-summary
```

---

## 4. OSPF (Open Shortest Path First)

### 4.1 OSPF 개요

OSPF는 가장 널리 사용되는 링크 상태 라우팅 프로토콜입니다.

```
┌─────────────────────────────────────────────────────────────────┐
│                       OSPF 특징                                  │
├─────────────────────────────────────────────────────────────────┤
│  • 메트릭: 비용 (Cost) = 참조 대역폭 / 인터페이스 대역폭        │
│  • 참조 대역폭: 기본 100 Mbps                                   │
│  • 관리 거리 (AD): 110                                          │
│  • 프로토콜: IP 프로토콜 89                                     │
│  • 멀티캐스트: 224.0.0.5 (AllSPFRouters)                       │
│               224.0.0.6 (AllDRouters)                           │
│  • 영역(Area) 기반 계층 구조                                    │
└─────────────────────────────────────────────────────────────────┘
```

### 4.2 OSPF 비용 계산

```
OSPF 비용 = 참조 대역폭 (100 Mbps) / 인터페이스 대역폭

┌─────────────────────┬───────────────┬────────────┐
│ 인터페이스 타입     │ 대역폭        │ OSPF 비용  │
├─────────────────────┼───────────────┼────────────┤
│ Serial (T1)         │ 1.544 Mbps    │ 64         │
│ Ethernet            │ 10 Mbps       │ 10         │
│ Fast Ethernet       │ 100 Mbps      │ 1          │
│ Gigabit Ethernet    │ 1000 Mbps     │ 1 (기본)   │
│ 10 Gigabit Ethernet │ 10000 Mbps    │ 1 (기본)   │
└─────────────────────┴───────────────┴────────────┘

※ Gig 이상은 참조 대역폭 조정 필요 (예: 10000 Mbps)
```

### 4.3 OSPF 영역 (Area)

```
                    OSPF 영역 구조

┌─────────────────────────────────────────────────────────────────┐
│                                                                  │
│                         Area 0                                   │
│                      (Backbone)                                  │
│                                                                  │
│            ┌─────────────────────────────┐                      │
│            │                             │                      │
│    ┌───────┴──┐    ┌─────────┐    ┌──────┴───────┐             │
│    │   ABR    │    │   ABR   │    │     ABR      │             │
│    └────┬─────┘    └────┬────┘    └──────┬───────┘             │
│         │               │                 │                      │
│    ┌────┴────┐    ┌────┴────┐    ┌──────┴──────┐              │
│    │ Area 1  │    │ Area 2  │    │   Area 3    │              │
│    │         │    │         │    │             │              │
│    │ R1──R2  │    │ R3──R4  │    │  R5──R6     │              │
│    │         │    │         │    │             │              │
│    └─────────┘    └─────────┘    └─────────────┘              │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘

ABR: Area Border Router (영역 경계 라우터)
```

**영역의 목적**:
- LSDB 크기 감소
- SPF 계산 범위 제한
- 라우팅 업데이트 감소
- 네트워크 안정성 향상

**영역 유형**:

| 영역 유형 | 설명 |
|----------|------|
| Backbone (Area 0) | 중심 영역, 모든 영역 연결 |
| Standard Area | 일반 영역 |
| Stub Area | 외부 경로 차단, 기본 경로 사용 |
| Totally Stubby | 외부 + 타 영역 경로 차단 |
| NSSA | 외부 경로를 제한적으로 허용 |

### 4.4 OSPF 라우터 유형

```
┌─────────────────────────────────────────────────────────────────┐
│                     OSPF 라우터 역할                             │
├──────────────────┬──────────────────────────────────────────────┤
│ Internal Router  │ 한 영역 내에서만 동작                        │
│                  │                                              │
│ ABR              │ Area Border Router                           │
│                  │ 여러 영역에 연결, 영역 간 라우팅 정보 전달   │
│                  │                                              │
│ ASBR             │ AS Boundary Router                           │
│                  │ 외부 라우팅 도메인과 연결                    │
│                  │                                              │
│ Backbone Router  │ Area 0에 속한 라우터                         │
│                  │                                              │
│ DR               │ Designated Router                            │
│                  │ 멀티액세스 네트워크에서 대표 라우터           │
│                  │                                              │
│ BDR              │ Backup Designated Router                     │
│                  │ DR 백업                                      │
└──────────────────┴──────────────────────────────────────────────┘
```

### 4.5 OSPF 패킷 유형

| 타입 | 이름 | 설명 |
|------|------|------|
| 1 | Hello | 이웃 발견 및 관계 유지 |
| 2 | DBD (Database Description) | LSDB 요약 정보 교환 |
| 3 | LSR (Link State Request) | 특정 LSA 요청 |
| 4 | LSU (Link State Update) | LSA 전송 |
| 5 | LSAck | LSA 수신 확인 |

### 4.6 OSPF 이웃 상태

```
OSPF 이웃 관계 수립 과정

Down → Init → 2-Way → ExStart → Exchange → Loading → Full

┌─────────────────────────────────────────────────────────────────┐
│  Down      : 초기 상태, Hello 패킷 미수신                        │
│  Init      : Hello 수신, 양방향 확인 안 됨                       │
│  2-Way     : 양방향 통신 확인 (DR/BDR 선출)                     │
│  ExStart   : Master/Slave 결정, 시퀀스 번호 교환                │
│  Exchange  : DBD 패킷으로 LSDB 요약 교환                        │
│  Loading   : LSR/LSU로 부족한 LSA 요청 및 수신                  │
│  Full      : LSDB 동기화 완료, 이웃 관계 수립                   │
└─────────────────────────────────────────────────────────────────┘
```

### 4.7 OSPF 설정 예시

**Cisco Router**:
```
Router(config)# router ospf 1
Router(config-router)# network 10.0.0.0 0.255.255.255 area 0
Router(config-router)# network 192.168.1.0 0.0.0.255 area 1
```

**Linux (FRR)**:
```
router ospf
 network 10.0.0.0/8 area 0.0.0.0
 network 192.168.1.0/24 area 0.0.0.1
```

---

## 5. BGP (Border Gateway Protocol)

### 5.1 BGP 개요

BGP는 인터넷의 백본에서 AS 간 라우팅에 사용되는 경로 벡터 프로토콜입니다.

```
┌─────────────────────────────────────────────────────────────────┐
│                       BGP 특징                                   │
├─────────────────────────────────────────────────────────────────┤
│  • 유형: 경로 벡터 (Path Vector) 프로토콜                       │
│  • 용도: AS 간 라우팅 (EGP)                                     │
│  • 포트: TCP 179                                                │
│  • 관리 거리: eBGP=20, iBGP=200                                 │
│  • 경로 선택: 정책 기반 (Path Attributes)                       │
│  • 현재 버전: BGP-4                                             │
└─────────────────────────────────────────────────────────────────┘
```

### 5.2 eBGP vs iBGP

```
                    eBGP와 iBGP

┌──────────────────────┐        ┌──────────────────────┐
│       AS 100         │        │       AS 200         │
│                      │        │                      │
│   R1 ◄──── iBGP ────► R2 ◄── eBGP ──► R3 ◄── iBGP ──► R4
│                      │        │                      │
│  (같은 AS 내부)      │        │  (같은 AS 내부)      │
└──────────────────────┘        └──────────────────────┘
        │                                    │
        └──────────── eBGP ──────────────────┘
                 (다른 AS 간)

eBGP (External BGP):
- 서로 다른 AS 간 연결
- AD: 20 (신뢰도 높음)
- 일반적으로 직접 연결

iBGP (Internal BGP):
- 같은 AS 내 BGP 라우터 간 연결
- AD: 200 (신뢰도 낮음)
- Full mesh 또는 Route Reflector 필요
```

### 5.3 BGP 경로 속성 (Path Attributes)

| 속성 | 유형 | 설명 |
|------|------|------|
| AS_PATH | Well-known Mandatory | 경로가 통과한 AS 목록 |
| NEXT_HOP | Well-known Mandatory | 다음 홉 IP 주소 |
| ORIGIN | Well-known Mandatory | 경로 출처 (IGP/EGP/Incomplete) |
| LOCAL_PREF | Well-known Discretionary | 로컬 선호도 (iBGP에서 사용) |
| MED | Optional Non-transitive | Multi-Exit Discriminator |
| COMMUNITY | Optional Transitive | 경로 그룹화 태그 |

### 5.4 BGP 경로 선택 과정

```
BGP 경로 선택 알고리즘 (Best Path Selection)

1. Weight (높을수록 선호) - Cisco 전용
2. LOCAL_PREF (높을수록 선호)
3. Locally Originated (자체 생성 경로 선호)
4. AS_PATH (짧을수록 선호)
5. ORIGIN (IGP > EGP > Incomplete)
6. MED (낮을수록 선호)
7. eBGP over iBGP
8. IGP 메트릭 (다음 홉까지 비용)
9. 가장 오래된 경로
10. Router ID (낮을수록 선호)
11. Neighbor IP (낮을수록 선호)

예시:
┌────────────────────────────────────────────────────┐
│ 경로 A: AS_PATH = 100 200 300, LOCAL_PREF = 100    │
│ 경로 B: AS_PATH = 400 500, LOCAL_PREF = 200        │
│                                                     │
│ 선택: 경로 B (LOCAL_PREF가 더 높음)                │
└────────────────────────────────────────────────────┘
```

### 5.5 BGP 메시지 유형

| 메시지 | 설명 |
|--------|------|
| OPEN | BGP 세션 설정, 파라미터 교환 |
| UPDATE | 경로 정보 광고/철회 |
| KEEPALIVE | 연결 유지 확인 (60초 간격) |
| NOTIFICATION | 오류 통지, 세션 종료 |

### 5.6 BGP 상태

```
BGP 상태 전이

Idle → Connect → OpenSent → OpenConfirm → Established

┌─────────────────────────────────────────────────────────────────┐
│  Idle        : 초기 상태, TCP 연결 시작                         │
│  Connect     : TCP 연결 대기                                    │
│  Active      : TCP 연결 재시도 (Connect 실패 시)                │
│  OpenSent    : OPEN 메시지 전송, 응답 대기                      │
│  OpenConfirm : OPEN 메시지 수신, KEEPALIVE 대기                 │
│  Established : BGP 세션 수립 완료, 경로 교환 시작               │
└─────────────────────────────────────────────────────────────────┘
```

### 5.7 BGP 설정 예시

**Cisco Router (eBGP)**:
```
Router(config)# router bgp 100
Router(config-router)# neighbor 203.0.113.1 remote-as 200
Router(config-router)# network 10.0.0.0 mask 255.0.0.0
```

**Linux (FRR)**:
```
router bgp 100
 neighbor 203.0.113.1 remote-as 200
 address-family ipv4 unicast
  network 10.0.0.0/8
 exit-address-family
```

---

## 6. AS (Autonomous System)

### 6.1 AS란?

AS(Autonomous System)는 동일한 라우팅 정책을 가진 네트워크들의 집합입니다.

```
┌─────────────────────────────────────────────────────────────────┐
│                    AS (자율 시스템)                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  정의:                                                          │
│  - 단일 기관에서 관리하는 IP 네트워크 및 라우터의 집합          │
│  - 공통된 라우팅 정책을 따름                                    │
│  - 고유한 AS 번호(ASN)로 식별                                   │
│                                                                  │
│  예시:                                                          │
│  - ISP (KT, SKT, LGU+)                                          │
│  - 대기업                                                       │
│  - 클라우드 제공자 (AWS, GCP, Azure)                            │
│  - 콘텐츠 제공자 (Netflix, Google)                              │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 6.2 AS 번호 (ASN)

| 범위 | 유형 | 설명 |
|------|------|------|
| 1 - 64,495 | 공인 2바이트 | 인터넷에서 사용 가능 |
| 64,496 - 64,511 | 문서용 | RFC 문서 예시용 |
| 64,512 - 65,534 | 사설 2바이트 | 내부 사용 |
| 65,535 | 예약 | 사용 불가 |
| 1 - 4,199,999,999 | 공인 4바이트 | 확장된 AS 번호 |
| 4,200,000,000 - 4,294,967,294 | 사설 4바이트 | 내부 사용 |

**유명 AS 번호 예시**:

| ASN | 조직 |
|-----|------|
| AS7018 | AT&T |
| AS15169 | Google |
| AS16509 | Amazon |
| AS32934 | Facebook |
| AS4766 | KT |
| AS9318 | SKT |

### 6.3 AS 간 관계

```
                    AS 피어링 관계

┌─────────────────────────────────────────────────────────────────┐
│                                                                  │
│  1. Transit (전송):                                             │
│     - 대형 ISP가 소형 ISP에게 인터넷 연결 제공                  │
│     - 유료 관계                                                 │
│                                                                  │
│     ┌─────────┐                                                 │
│     │ Tier 1  │  ← 비용 지불                                    │
│     │   ISP   │                                                 │
│     └────┬────┘                                                 │
│          │ Transit                                               │
│     ┌────┴────┐                                                 │
│     │ Tier 2  │                                                 │
│     │   ISP   │                                                 │
│     └─────────┘                                                 │
│                                                                  │
│  2. Peering (피어링):                                           │
│     - 동급 ISP 간 무료 트래픽 교환                              │
│     - IXP(Internet Exchange Point)에서 연결                     │
│                                                                  │
│     ┌─────────┐     무료 교환     ┌─────────┐                  │
│     │  AS A   │◄─────────────────►│  AS B   │                  │
│     └─────────┘     (Peering)     └─────────┘                  │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 6.4 인터넷 계층 구조

```
                    인터넷 AS 계층

                     ┌─────────────┐
                     │   Tier 1    │  ← 전체 인터넷 도달 가능
                     │ (글로벌 ISP)│    Transit 구매 불필요
                     └──────┬──────┘
                            │
              ┌─────────────┼─────────────┐
              │             │             │
         ┌────┴────┐  ┌────┴────┐  ┌────┴────┐
         │ Tier 2  │  │ Tier 2  │  │ Tier 2  │  ← 지역 ISP
         │         │  │         │  │         │    Tier 1에서
         └────┬────┘  └────┬────┘  └────┬────┘    Transit 구매
              │             │             │
         ┌────┴────┐  ┌────┴────┐  ┌────┴────┐
         │ Tier 3  │  │ Tier 3  │  │ Tier 3  │  ← 로컬 ISP
         │         │  │         │  │         │    최종 사용자
         └─────────┘  └─────────┘  └─────────┘    서비스

Tier 1 예: AT&T, NTT, Cogent, Lumen
Tier 2 예: 대형 지역 ISP
Tier 3 예: 소형 지역 ISP, 케이블 사업자
```

---

## 7. 연습 문제

### 문제 1: 프로토콜 특성 매칭

다음 특성과 해당 프로토콜을 연결하세요.

```
특성:
a) 최대 홉 수 15
b) Dijkstra 알고리즘 사용
c) AS 간 라우팅에 사용
d) 30초마다 전체 라우팅 테이블 전송
e) 영역(Area) 기반 계층 구조
f) TCP 포트 179 사용

프로토콜: RIP, OSPF, BGP
```

### 문제 2: OSPF 비용 계산

참조 대역폭이 100 Mbps일 때, 다음 경로의 총 OSPF 비용을 계산하세요.

```
R1 ──(FastEthernet)── R2 ──(Serial T1)── R3 ──(GigabitEthernet)── R4
        100 Mbps           1.544 Mbps          1000 Mbps
```

### 문제 3: BGP 경로 선택

다음 두 BGP 경로 중 어느 것이 선택될까요?

```
경로 A:
- AS_PATH: 100 200 300
- LOCAL_PREF: 150
- MED: 100

경로 B:
- AS_PATH: 400 500
- LOCAL_PREF: 150
- MED: 50
```

### 문제 4: 라우팅 프로토콜 선택

다음 시나리오에 적합한 라우팅 프로토콜을 선택하고 이유를 설명하세요.

a) 10대의 라우터가 있는 소규모 사무실
b) 500대의 라우터가 있는 대기업 네트워크
c) 두 ISP 간 연결
d) 단일 경로만 있는 지사 네트워크

---

## 정답

### 문제 1 정답

- a) 최대 홉 수 15 → **RIP**
- b) Dijkstra 알고리즘 → **OSPF**
- c) AS 간 라우팅 → **BGP**
- d) 30초 전체 테이블 전송 → **RIP**
- e) 영역 기반 구조 → **OSPF**
- f) TCP 179 → **BGP**

### 문제 2 정답

```
FastEthernet: 100 / 100 = 1
Serial T1:    100 / 1.544 = 64 (반올림)
GigabitEthernet: 100 / 1000 = 1 (최소값 1)

총 비용 = 1 + 64 + 1 = 66
```

### 문제 3 정답

**경로 B 선택**

분석 과정:
1. LOCAL_PREF: 둘 다 150 (동일)
2. AS_PATH 길이: 경로 A = 3, 경로 B = 2
   → **경로 B가 AS_PATH가 짧아서 선택**

(MED는 같은 이웃 AS에서 온 경로 비교에만 사용)

### 문제 4 정답

a) 소규모 사무실 (10대): **RIP** 또는 **정적 라우팅**
   - 단순한 네트워크에 적합
   - 설정 및 관리 용이

b) 대기업 (500대): **OSPF**
   - 빠른 수렴
   - 영역 분할로 확장성 확보
   - VLSM/CIDR 지원

c) ISP 간 연결: **BGP**
   - AS 간 라우팅의 표준
   - 정책 기반 경로 제어

d) 단일 경로 지사: **정적 라우팅** (+ 기본 경로)
   - 동적 라우팅 불필요
   - 리소스 절약

---

## 8. 다음 단계

라우팅 프로토콜을 이해했다면, 전송 계층으로 넘어가세요.

### 다음 레슨
- [10_TCP_Protocol.md](./10_TCP_Protocol.md) - TCP 3-way handshake, 흐름 제어

### 관련 레슨
- [08_Routing_Basics.md](./08_Routing_Basics.md) - 라우팅 기본 개념
- [15_Network_Security_Basics.md](./15_Network_Security_Basics.md) - 방화벽, VPN

### 추천 실습
1. GNS3/Packet Tracer에서 OSPF 구성
2. `show ip route` 명령으로 라우팅 테이블 분석
3. BGP Looking Glass로 인터넷 경로 확인

---

## 9. 참고 자료

### RFC 문서

- RFC 2453 - RIP Version 2
- RFC 2328 - OSPF Version 2
- RFC 4271 - BGP-4
- RFC 1930 - AS 운영 가이드라인

### 유용한 도구

```bash
# BGP 경로 조회
# BGP Looking Glass: https://lg.he.net/

# AS 정보 조회
whois -h whois.radb.net AS15169

# 경로 추적
traceroute -A google.com    # AS 번호 표시 (Linux)
mtr google.com              # 실시간 추적
```

### 학습 자료

- [BGP Table Statistics](https://bgp.potaroo.net/)
- [Hurricane Electric BGP Toolkit](https://bgp.he.net/)
- [PeeringDB](https://www.peeringdb.com/)
- Cisco Networking Academy

### 시뮬레이터

- GNS3 - 실제 라우터 이미지 사용
- Cisco Packet Tracer - 학습용 무료 시뮬레이터
- EVE-NG - 가상 네트워크 랩

---

**문서 정보**
- 최종 수정: 2024년
- 난이도: ⭐⭐⭐
- 예상 학습 시간: 3-4시간
