# Caching Strategies

## Overview

This document covers core caching strategies and patterns. Understand the differences between Cache-Aside, Read-Through, Write-Through, and Write-Behind patterns, along with cache invalidation, TTL configuration, and solutions to cache penetration/avalanche/hotkey problems.

**Difficulty**: â­â­â­
**Estimated Learning Time**: 2-3 hours
**Prerequisites**: [05_Reverse_Proxy_API_Gateway.md](./05_Reverse_Proxy_API_Gateway.md)

---

## Table of Contents

1. [What is Caching?](#1-what-is-caching)
2. [Caching Strategy Patterns](#2-caching-strategy-patterns)
3. [Cache Invalidation](#3-cache-invalidation)
4. [Cache Problems and Solutions](#4-cache-problems-and-solutions)
5. [CDN Caching](#5-cdn-caching)
6. [Practice Problems](#6-practice-problems)
7. [Next Steps](#7-next-steps)
8. [References](#8-references)

---

## 1. What is Caching?

### 1.1 Definition of Caching

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      What is Caching?                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  "Temporarily store frequently used data in fast storage"       â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Without cache:                                            â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Client â”€â”€â–¶ Server â”€â”€â–¶ Database                            â”‚ â”‚
â”‚  â”‚         â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    (Query DB every time)           â”‚ â”‚
â”‚  â”‚         ~100ms                                             â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  With cache:                                               â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Client â”€â”€â–¶ Server â”€â”€â–¶ Cache (Hit!) â”€â”€â–¶ Response          â”‚ â”‚
â”‚  â”‚         â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    ~1ms                              â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  On Cache Miss:                                            â”‚ â”‚
â”‚  â”‚  Server â”€â”€â–¶ Database â”€â”€â–¶ Store in cache â”€â”€â–¶ Response      â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  100x faster response possible!                                 â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 Cache Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Cache Layers                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Client                                                         â”‚
â”‚    â”‚                                                            â”‚
â”‚    â”œâ”€â”€ Browser cache (fastest)                                 â”‚
â”‚    â”‚     L1: Memory cache                                       â”‚
â”‚    â”‚     L2: Disk cache                                         â”‚
â”‚    â”‚                                                            â”‚
â”‚    â”œâ”€â”€ CDN cache (Edge)                                         â”‚
â”‚    â”‚     Geographically close servers                           â”‚
â”‚    â”‚                                                            â”‚
â”‚    â”œâ”€â”€ Reverse proxy cache                                      â”‚
â”‚    â”‚     Nginx, Varnish                                         â”‚
â”‚    â”‚                                                            â”‚
â”‚    â”œâ”€â”€ Application cache                                        â”‚
â”‚    â”‚     Local cache (in-memory)                                â”‚
â”‚    â”‚     Distributed cache (Redis, Memcached)                   â”‚
â”‚    â”‚                                                            â”‚
â”‚    â””â”€â”€ Database cache                                           â”‚
â”‚          Query Cache, Buffer Pool                               â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚       Fast                              Slow                â”‚ â”‚
â”‚  â”‚  â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶         â”‚ â”‚
â”‚  â”‚  Browser â†’ CDN â†’ Proxy â†’ App Cache â†’ DB                    â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚       Small                             Large              â”‚ â”‚
â”‚  â”‚  â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶         â”‚ â”‚
â”‚  â”‚        (Storage capacity)                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 Cache Hit Rate

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Cache Hit Rate                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Cache Hit Rate = (Cache Hits) / (Total Requests) Ã— 100%        â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Example: 1000 requests, 950 Hit, 50 Miss                 â”‚ â”‚
â”‚  â”‚  Hit Rate = 950 / 1000 = 95%                               â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  Effect by hit rate:                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Hit Rate   â”‚ DB Load Reduction  â”‚ Avg Response Time      â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”‚ â”‚
â”‚  â”‚  50%        â”‚ 50%               â”‚ 50ms (example)          â”‚ â”‚
â”‚  â”‚  90%        â”‚ 90%               â”‚ 10ms                    â”‚ â”‚
â”‚  â”‚  95%        â”‚ 95%               â”‚ 5ms                     â”‚ â”‚
â”‚  â”‚  99%        â”‚ 99%               â”‚ 2ms                     â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  High hit rate = Faster response + DB protection          â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  Hit rate improvement strategies:                                â”‚
â”‚  â€¢ Appropriate TTL configuration                                 â”‚
â”‚  â€¢ Cache size optimization                                       â”‚
â”‚  â€¢ Hot data preloading                                           â”‚
â”‚  â€¢ Cache key design optimization                                 â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Caching Strategy Patterns

### 2.1 Cache-Aside (Lazy Loading)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Cache-Aside Pattern                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  "Application directly manages cache"                           â”‚
â”‚                                                                  â”‚
â”‚  Read:                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Application                                               â”‚ â”‚
â”‚  â”‚      â”‚                                                     â”‚ â”‚
â”‚  â”‚      â”‚ 1. Check cache                                      â”‚ â”‚
â”‚  â”‚      â–¼                                                     â”‚ â”‚
â”‚  â”‚   [Cache] â”€â”€Hit?â”€â”€â–¶ Yes â”€â”€â–¶ Return data                    â”‚ â”‚
â”‚  â”‚      â”‚                                                     â”‚ â”‚
â”‚  â”‚     No (Miss)                                              â”‚ â”‚
â”‚  â”‚      â”‚                                                     â”‚ â”‚
â”‚  â”‚      â”‚ 2. Query DB                                         â”‚ â”‚
â”‚  â”‚      â–¼                                                     â”‚ â”‚
â”‚  â”‚  [Database] â”€â”€â–¶ Return data                                â”‚ â”‚
â”‚  â”‚      â”‚                                                     â”‚ â”‚
â”‚  â”‚      â”‚ 3. Store in cache                                   â”‚ â”‚
â”‚  â”‚      â–¼                                                     â”‚ â”‚
â”‚  â”‚   [Cache] (update)                                         â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  Write:                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Application                                               â”‚ â”‚
â”‚  â”‚      â”‚                                                     â”‚ â”‚
â”‚  â”‚      â”‚ 1. Write to DB                                      â”‚ â”‚
â”‚  â”‚      â–¼                                                     â”‚ â”‚
â”‚  â”‚  [Database] (update)                                       â”‚ â”‚
â”‚  â”‚      â”‚                                                     â”‚ â”‚
â”‚  â”‚      â”‚ 2. Invalidate cache (delete)                        â”‚ â”‚
â”‚  â”‚      â–¼                                                     â”‚ â”‚
â”‚  â”‚   [Cache] (delete)                                         â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  Code example:                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  def get_user(user_id):                                    â”‚ â”‚
â”‚  â”‚      # 1. Check cache                                      â”‚ â”‚
â”‚  â”‚      user = cache.get(f"user:{user_id}")                   â”‚ â”‚
â”‚  â”‚      if user:                                              â”‚ â”‚
â”‚  â”‚          return user  # Cache Hit                          â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚      # 2. Query DB (Cache Miss)                            â”‚ â”‚
â”‚  â”‚      user = db.query(f"SELECT * FROM users WHERE id={id}") â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚      # 3. Store in cache                                   â”‚ â”‚
â”‚  â”‚      cache.set(f"user:{user_id}", user, ttl=3600)          â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚      return user                                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  Pros:                                                           â”‚
â”‚  â€¢ Only cache needed data (memory efficient)                    â”‚
â”‚  â€¢ Works with DB even if cache fails                            â”‚
â”‚                                                                  â”‚
â”‚  Cons:                                                           â”‚
â”‚  â€¢ First request always slow (Cache Miss)                       â”‚
â”‚  â€¢ Possible cache-DB inconsistency                              â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Read-Through

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Read-Through Pattern                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  "Cache handles DB queries"                                     â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Application                                               â”‚ â”‚
â”‚  â”‚      â”‚                                                     â”‚ â”‚
â”‚  â”‚      â”‚ 1. Request to cache (always)                        â”‚ â”‚
â”‚  â”‚      â–¼                                                     â”‚ â”‚
â”‚  â”‚   [Cache] â”€â”€Hit?â”€â”€â–¶ Yes â”€â”€â–¶ Return data                    â”‚ â”‚
â”‚  â”‚      â”‚                                                     â”‚ â”‚
â”‚  â”‚     No (Miss)                                              â”‚ â”‚
â”‚  â”‚      â”‚                                                     â”‚ â”‚
â”‚  â”‚      â”‚ 2. Cache queries DB (automatic)                     â”‚ â”‚
â”‚  â”‚      â–¼                                                     â”‚ â”‚
â”‚  â”‚  [Database]                                                â”‚ â”‚
â”‚  â”‚      â”‚                                                     â”‚ â”‚
â”‚  â”‚      â”‚ 3. Store in cache + return                          â”‚ â”‚
â”‚  â”‚      â–¼                                                     â”‚ â”‚
â”‚  â”‚  Application                                               â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Application only sees cache!                              â”‚ â”‚
â”‚  â”‚  DB query logic built into cache                           â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  Cache-Aside vs Read-Through:                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Cache-Aside: App manages both cache and DB                â”‚ â”‚
â”‚  â”‚  Read-Through: App only uses cache, cache manages DB       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  Pros:                                                           â”‚
â”‚  â€¢ Simplified application code                                  â”‚
â”‚  â€¢ Centralized cache logic                                      â”‚
â”‚                                                                  â”‚
â”‚  Cons:                                                           â”‚
â”‚  â€¢ Need to implement loader in cache system                     â”‚
â”‚  â€¢ Reduced flexibility                                           â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 Write-Through

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Write-Through Pattern                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  "Update cache and DB simultaneously on write (synchronous)"    â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Application                                               â”‚ â”‚
â”‚  â”‚      â”‚                                                     â”‚ â”‚
â”‚  â”‚      â”‚ 1. Write to cache                                   â”‚ â”‚
â”‚  â”‚      â–¼                                                     â”‚ â”‚
â”‚  â”‚   [Cache] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚ â”‚
â”‚  â”‚      â”‚                                         â”‚           â”‚ â”‚
â”‚  â”‚      â”‚ 2. Cache writes to DB (sync)            â”‚           â”‚ â”‚
â”‚  â”‚      â–¼                                         â”‚ Both      â”‚ â”‚
â”‚  â”‚  [Database]                                    â”‚ complete  â”‚ â”‚
â”‚  â”‚      â”‚                                         â”‚           â”‚ â”‚
â”‚  â”‚      â”‚ 3. Respond after completion             â”‚           â”‚ â”‚
â”‚  â”‚      â–¼                                         â”‚           â”‚ â”‚
â”‚  â”‚  Application â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  Characteristics:                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  â€¢ Cache and DB always synchronized (strong consistency)   â”‚ â”‚
â”‚  â”‚  â€¢ Effective when used with Read-Through                   â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  Pros:                                                           â”‚
â”‚  â€¢ Data consistency guaranteed                                  â”‚
â”‚  â€¢ No data loss                                                  â”‚
â”‚                                                                  â”‚
â”‚  Cons:                                                           â”‚
â”‚  â€¢ Write latency (write to two places)                          â”‚
â”‚  â€¢ May cache unnecessary data                                   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 Write-Behind (Write-Back)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Write-Behind (Write-Back) Pattern                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  "Write to cache first, DB later (asynchronous)"                â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Application                                               â”‚ â”‚
â”‚  â”‚      â”‚                                                     â”‚ â”‚
â”‚  â”‚      â”‚ 1. Write to cache                                   â”‚ â”‚
â”‚  â”‚      â–¼                                                     â”‚ â”‚
â”‚  â”‚   [Cache] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Immediate response               â”‚ â”‚
â”‚  â”‚      â”‚                                                     â”‚ â”‚
â”‚  â”‚      â”‚ 2. Write to DB later (async)                        â”‚ â”‚
â”‚  â”‚      â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚ â”‚
â”‚  â”‚      â”‚    â”‚ Write Queue                 â”‚                  â”‚ â”‚
â”‚  â”‚      â”‚    â”‚ [data1, data2, data3, ...]  â”‚                  â”‚ â”‚
â”‚  â”‚      â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚ â”‚
â”‚  â”‚      â”‚              â”‚                                      â”‚ â”‚
â”‚  â”‚      â”‚              â”‚ Batch processing                     â”‚ â”‚
â”‚  â”‚      â”‚              â–¼                                      â”‚ â”‚
â”‚  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ [Database]                                â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  Timeline:                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  T=0: Write 1 â†’ Cache (immediate)                          â”‚ â”‚
â”‚  â”‚  T=1: Write 2 â†’ Cache (immediate)                          â”‚ â”‚
â”‚  â”‚  T=2: Write 3 â†’ Cache (immediate)                          â”‚ â”‚
â”‚  â”‚  ...                                                       â”‚ â”‚
â”‚  â”‚  T=10: Batch write 1,2,3 to DB at once                    â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  Pros:                                                           â”‚
â”‚  â€¢ Excellent write performance (write to cache and respond)     â”‚
â”‚  â€¢ Reduced DB load (batch processing)                           â”‚
â”‚  â€¢ Can merge writes (multiple writes to same key â†’ save last)   â”‚
â”‚                                                                  â”‚
â”‚  Cons:                                                           â”‚
â”‚  â€¢ Risk of data loss (if cache fails)                           â”‚
â”‚  â€¢ Complex implementation                                        â”‚
â”‚  â€¢ Consistency issues (data not yet in DB)                      â”‚
â”‚                                                                  â”‚
â”‚  Use cases:                                                      â”‚
â”‚  â€¢ Log collection                                                â”‚
â”‚  â€¢ View/like counters                                            â”‚
â”‚  â€¢ When performance more important than real-time consistency   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.5 Pattern Comparison Summary

| Pattern | Read | Write | Consistency | Performance | Complexity |
|---------|------|-------|------------|----------|-----------|
| Cache-Aside | App manages | Direct to DB, invalidate cache | Weak | Good | Low |
| Read-Through | Cache manages | - | - | Good | Medium |
| Write-Through | - | Cacheâ†’DB sync | Strong | Fair | Medium |
| Write-Behind | - | Cache first, DB later | Weak | Excellent | High |

---

## 3. Cache Invalidation

### 3.1 Invalidation Strategies

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Cache Invalidation Strategies                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  "When and how to delete/update cached data?"                   â”‚
â”‚                                                                  â”‚
â”‚  1. TTL (Time To Live) based                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  cache.set("user:123", data, ttl=3600)  # Expires in 1h   â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  T=0:     [user:123] stored                                â”‚ â”‚
â”‚  â”‚  T=3600:  [user:123] automatically deleted                 â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Pros: Simple, automatic                                   â”‚ â”‚
â”‚  â”‚  Cons: May serve stale data during TTL                     â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  2. Explicit Invalidation                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  # On data modification                                    â”‚ â”‚
â”‚  â”‚  db.update_user(user_id, new_data)                         â”‚ â”‚
â”‚  â”‚  cache.delete(f"user:{user_id}")  # Delete cache          â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Pros: Immediate consistency recovery                      â”‚ â”‚
â”‚  â”‚  Cons: Need deletion logic, error-prone                    â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  3. Event-based Invalidation                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  DB Change â”€â”€â–¶ Publish event â”€â”€â–¶ Cache invalidation        â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  [DB] â”€â”€CDCâ”€â”€â–¶ [Kafka] â”€â”€â–¶ [Cache Invalidator]             â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Pros: Loose coupling, scalability                         â”‚ â”‚
â”‚  â”‚  Cons: Increased complexity, possible latency              â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 TTL Configuration Guide

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     TTL Configuration Guide                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Recommended TTL by data characteristics:                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Rarely changing data:                                     â”‚ â”‚
â”‚  â”‚  â€¢ Configuration values, metadata: 24 hours ~ 7 days       â”‚ â”‚
â”‚  â”‚  â€¢ Country/region info: 7+ days                            â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Infrequently changing data:                               â”‚ â”‚
â”‚  â”‚  â€¢ User profiles: 1 hour ~ 24 hours                        â”‚ â”‚
â”‚  â”‚  â€¢ Product info: 1 hour ~ 6 hours                          â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Frequently changing data:                                 â”‚ â”‚
â”‚  â”‚  â€¢ Inventory quantity: 1 min ~ 5 min                       â”‚ â”‚
â”‚  â”‚  â€¢ Real-time stats: 30 sec ~ 1 min                         â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Real-time data:                                           â”‚ â”‚
â”‚  â”‚  â€¢ Don't cache or very short TTL (seconds)                 â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  TTL decision formula:                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  TTL = f(change frequency, consistency requirements,       â”‚ â”‚
â”‚  â”‚           traffic pattern)                                 â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  â€¢ Low change frequency â†’ Longer TTL                       â”‚ â”‚
â”‚  â”‚  â€¢ Important consistency â†’ Short TTL or explicit invalidationâ”‚ â”‚
â”‚  â”‚  â€¢ High traffic â†’ Longer TTL (hit rate important)          â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  TTL Jitter:                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Problem: Same TTL â†’ Simultaneous expiry â†’ Cache stampede â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Solution: Add random value to TTL                         â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  base_ttl = 3600  # 1 hour                                 â”‚ â”‚
â”‚  â”‚  jitter = random(-300, 300)  # Â±5 minutes                  â”‚ â”‚
â”‚  â”‚  ttl = base_ttl + jitter  # 55 min ~ 65 min               â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Cache Problems and Solutions

### 4.1 Cache Penetration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Cache Penetration                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  "Continuous requests for non-existent data â†’ DB overload"      â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Attacker: GET /user?id=-1 (non-existent ID)               â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Every time:                                               â”‚ â”‚
â”‚  â”‚  1. Check cache â†’ Miss                                     â”‚ â”‚
â”‚  â”‚  2. Query DB â†’ No result                                   â”‚ â”‚
â”‚  â”‚  3. Don't cache (because empty)                            â”‚ â”‚
â”‚  â”‚  4. Next request repeats same process!                     â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Request â”€â”€â–¶ [Cache] â”€â”€Missâ”€â”€â–¶ [DB] â”€â”€â–¶ Empty              â”‚ â”‚
â”‚  â”‚  Request â”€â”€â–¶ [Cache] â”€â”€Missâ”€â”€â–¶ [DB] â”€â”€â–¶ Empty (repeat)     â”‚ â”‚
â”‚  â”‚  Request â”€â”€â–¶ [Cache] â”€â”€Missâ”€â”€â–¶ [DB] â”€â”€â–¶ Empty              â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  Solution 1: Cache null values                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  data = cache.get(key)                                     â”‚ â”‚
â”‚  â”‚  if data is None:                                          â”‚ â”‚
â”‚  â”‚      data = db.query(key)                                  â”‚ â”‚
â”‚  â”‚      if data is None:                                      â”‚ â”‚
â”‚  â”‚          cache.set(key, "NULL", ttl=60)  # Short TTL       â”‚ â”‚
â”‚  â”‚      else:                                                 â”‚ â”‚
â”‚  â”‚          cache.set(key, data, ttl=3600)                    â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  Solution 2: Bloom Filter                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  [Bloom Filter] â”€â”€"Does key possibly exist?"               â”‚ â”‚
â”‚  â”‚       â”‚                                                    â”‚ â”‚
â”‚  â”‚       â”œâ”€â”€ Definitely doesn't exist â†’ Return (no DB query)  â”‚ â”‚
â”‚  â”‚       â”‚                                                    â”‚ â”‚
â”‚  â”‚       â””â”€â”€ Might exist â†’ Query cache/DB                     â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Bloom Filter: Memory-efficient existence check            â”‚ â”‚
â”‚  â”‚  False Positive possible, False Negative impossible        â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Cache Avalanche

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Cache Avalanche                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  "Mass cache expiry at once â†’ DB surge"                         â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  T=0: Cache warming (1000 items, TTL=3600)                 â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  T=3600: 1000 items expire simultaneously!                â”‚ â”‚
â”‚  â”‚          â”€â”€â–¶ 1000 simultaneous DB queries                  â”‚ â”‚
â”‚  â”‚          â”€â”€â–¶ DB overload / failure                         â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  [Cache] â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•             â”‚ â”‚
â”‚  â”‚          â”‚  All Expired!  â”‚                                â”‚ â”‚
â”‚  â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚ â”‚
â”‚  â”‚                   â”‚                                        â”‚ â”‚
â”‚  â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚ â”‚
â”‚  â”‚          â”‚ Simultaneous    â”‚                               â”‚ â”‚
â”‚  â”‚          â”‚ DB requests     â”‚                               â”‚ â”‚
â”‚  â”‚          â”‚ 1000!          â”‚                                â”‚ â”‚
â”‚  â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚ â”‚
â”‚  â”‚                   â”‚                                        â”‚ â”‚
â”‚  â”‚                   â–¼                                        â”‚ â”‚
â”‚  â”‚              [DB] ğŸ’¥ Overload                              â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  Solution 1: TTL distribution (Jitter)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  ttl = base_ttl + random(0, 600)  # Add 0~10 min random   â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  â†’ Expiry times distributed                                â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  Solution 2: Cache warming (Pre-loading)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  â€¢ Preload hot data on server start                        â”‚ â”‚
â”‚  â”‚  â€¢ Background refresh before expiry                        â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  Solution 3: Multi-layer cache                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  [L1 Cache] â”€â”€Missâ”€â”€â–¶ [L2 Cache] â”€â”€Missâ”€â”€â–¶ [DB]            â”‚ â”‚
â”‚  â”‚   (local)             (distributed)                        â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  Solution 4: Mutex/Lock                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  On cache miss, only one request queries DB, others wait  â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  def get_with_lock(key):                                   â”‚ â”‚
â”‚  â”‚      data = cache.get(key)                                 â”‚ â”‚
â”‚  â”‚      if data:                                              â”‚ â”‚
â”‚  â”‚          return data                                       â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚      if cache.setnx(f"lock:{key}", 1, ttl=10):             â”‚ â”‚
â”‚  â”‚          # Lock acquired â†’ Query DB                        â”‚ â”‚
â”‚  â”‚          data = db.query(key)                              â”‚ â”‚
â”‚  â”‚          cache.set(key, data)                              â”‚ â”‚
â”‚  â”‚          cache.delete(f"lock:{key}")                       â”‚ â”‚
â”‚  â”‚      else:                                                 â”‚ â”‚
â”‚  â”‚          # Lock failed â†’ Wait and retry                    â”‚ â”‚
â”‚  â”‚          sleep(0.1)                                        â”‚ â”‚
â”‚  â”‚          return cache.get(key)                             â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 Hot Key Problem

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Hot Key Problem                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  "Traffic concentration on specific key â†’ Node overload"        â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Example: Celebrity post, flash sale product               â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚       product:12345 (hot product)                          â”‚ â”‚
â”‚  â”‚             â”‚                                              â”‚ â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚ â”‚
â”‚  â”‚    â”‚        â”‚        â”‚                                     â”‚ â”‚
â”‚  â”‚    â–¼        â–¼        â–¼                                     â”‚ â”‚
â”‚  â”‚  [Request] [Request] [Request]  Ã—10000                     â”‚ â”‚
â”‚  â”‚             â”‚                                              â”‚ â”‚
â”‚  â”‚             â–¼                                              â”‚ â”‚
â”‚  â”‚    [Redis Node 1] ğŸ’¥ Overload                              â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Other nodes idle but one node overloaded!                â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  Solution 1: Add local cache                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  [App Server 1] â”€â”€[Local Cache]                            â”‚ â”‚
â”‚  â”‚  [App Server 2] â”€â”€[Local Cache]                            â”‚ â”‚
â”‚  â”‚  [App Server 3] â”€â”€[Local Cache]                            â”‚ â”‚
â”‚  â”‚          â”‚               â”‚                                 â”‚ â”‚
â”‚  â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚ â”‚
â”‚  â”‚                  â”‚                                         â”‚ â”‚
â”‚  â”‚                  â–¼                                         â”‚ â”‚
â”‚  â”‚            [Redis Cluster]                                 â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Distribute hot key with local cache!                      â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  Solution 2: Key replication                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Original: product:12345                                   â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Replicate: product:12345:0                                â”‚ â”‚
â”‚  â”‚             product:12345:1                                â”‚ â”‚
â”‚  â”‚             product:12345:2                                â”‚ â”‚
â”‚  â”‚             ...                                            â”‚ â”‚
â”‚  â”‚             product:12345:N                                â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  On query: product:12345:{random(0, N)}                    â”‚ â”‚
â”‚  â”‚  â†’ Distributed across multiple nodes!                      â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  Solution 3: Read replicas                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  [Master] â”€â”€replicateâ”€â”€â–¶ [Replica 1]                       â”‚ â”‚
â”‚  â”‚               â”€â”€â–¶ [Replica 2]                              â”‚ â”‚
â”‚  â”‚               â”€â”€â–¶ [Replica 3]                              â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Distribute read requests across replicas                  â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.4 Problem Summary

| Problem | Cause | Impact | Solution |
|---------|-------|--------|----------|
| Cache Penetration | Query non-existent data | DB overload | Null caching, Bloom Filter |
| Cache Avalanche | Simultaneous expiry | DB surge | TTL Jitter, lock, warming |
| Hot Key | Traffic on specific key | Node overload | Local cache, key replication |

---

## 5. CDN Caching

### 5.1 CDN Caching Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CDN Caching                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  "Cache static content on edge servers"                         â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚ â”‚
â”‚  â”‚              â”‚   Origin    â”‚                               â”‚ â”‚
â”‚  â”‚              â”‚   Server    â”‚                               â”‚ â”‚
â”‚  â”‚              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                               â”‚ â”‚
â”‚  â”‚                     â”‚                                      â”‚ â”‚
â”‚  â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚ â”‚
â”‚  â”‚        â”‚            â”‚            â”‚                         â”‚ â”‚
â”‚  â”‚        â–¼            â–¼            â–¼                         â”‚ â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚ â”‚
â”‚  â”‚   â”‚ Edge    â”‚  â”‚ Edge    â”‚  â”‚ Edge    â”‚                   â”‚ â”‚
â”‚  â”‚   â”‚ Seoul   â”‚  â”‚ Tokyo   â”‚  â”‚ NYC     â”‚                   â”‚ â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                   â”‚ â”‚
â”‚  â”‚        â”‚            â”‚            â”‚                         â”‚ â”‚
â”‚  â”‚        â–¼            â–¼            â–¼                         â”‚ â”‚
â”‚  â”‚   Korea users   Japan users   US users                     â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  CDN caching targets:                                            â”‚
â”‚  â€¢ Images, CSS, JavaScript                                       â”‚
â”‚  â€¢ Fonts, videos                                                 â”‚
â”‚  â€¢ API responses (GET, cacheable)                                â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 Cache-Control Headers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Cache-Control Headers                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Main directives:                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  max-age=3600                                              â”‚ â”‚
â”‚  â”‚    Browser/CDN cache time (seconds)                        â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  s-maxage=86400                                            â”‚ â”‚
â”‚  â”‚    CDN/shared cache specific time (overrides max-age)      â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  public                                                    â”‚ â”‚
â”‚  â”‚    Can be cached by any cache                              â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  private                                                   â”‚ â”‚
â”‚  â”‚    Can only be cached by browser (not CDN)                 â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  no-cache                                                  â”‚ â”‚
â”‚  â”‚    Must validate with origin before using cache            â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  no-store                                                  â”‚ â”‚
â”‚  â”‚    Do not cache                                            â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  stale-while-revalidate=60                                 â”‚ â”‚
â”‚  â”‚    Serve stale cache while revalidating in background      â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  immutable                                                 â”‚ â”‚
â”‚  â”‚    Content never changes (version in URL)                  â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  Examples:                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  # Static assets (1 year)                                  â”‚ â”‚
â”‚  â”‚  Cache-Control: public, max-age=31536000, immutable        â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  # API response (CDN 1 hour, browser 5 min)                â”‚ â”‚
â”‚  â”‚  Cache-Control: public, max-age=300, s-maxage=3600         â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  # Personal data (browser only)                            â”‚ â”‚
â”‚  â”‚  Cache-Control: private, max-age=600                       â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  # Sensitive data (no caching)                             â”‚ â”‚
â”‚  â”‚  Cache-Control: no-store                                   â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Practice Problems

### Problem 1: Caching Strategy Selection

Choose an appropriate caching pattern for the following scenarios:

a) Read-heavy service (read:write = 100:1)
b) Write-heavy log system
c) Inventory management requiring strong consistency
d) Simple web application

### Problem 2: TTL Configuration

Set appropriate TTL for the following data:

a) User profile (changed several times a day)
b) Product price (real-time fluctuation)
c) Country list (rarely changes)
d) Real-time stock price

### Problem 3: Cache Problem Resolution

Identify the problem and propose a solution for the following situation:

Situation: "Every day at midnight, all cache expires and server becomes slow."

### Problem 4: Write Cache-Control

Write Cache-Control headers for the following requirements:

a) Static image (versioned URL, 1 year cache)
b) API response (CDN 10 min, browser 1 min)
c) Login status check API (no caching)

---

## Answers

### Problem 1 Answer

```
a) Read-heavy service: Cache-Aside
   - Check cache first on read
   - Query DB on cache miss then cache
   - Optimized for reads

b) Write-heavy log system: Write-Behind
   - Write to cache quickly and respond
   - Batch save to DB
   - Maximizes write performance

c) Strong consistency inventory: Write-Through
   - Update cache and DB simultaneously
   - Always consistent inventory count
   - Prevents overselling

d) Simple web application: Cache-Aside
   - Simple implementation
   - Works with DB even if cache fails
   - Most versatile
```

### Problem 2 Answer

```
a) User profile: 1-4 hours
   - Low change frequency
   - Use with explicit invalidation

b) Product price: 1-5 minutes or don't cache
   - Price accuracy important
   - Short TTL or event-based invalidation

c) Country list: 24 hours ~ 7 days
   - Rarely changes
   - Long TTL maximizes cache efficiency

d) Real-time stock price: Don't cache
   - Real-time critical
   - Stale data is risky
```

### Problem 3 Answer

```
Problem: Cache Avalanche
         All cache expires at midnight simultaneously

Solutions:
1. TTL Jitter
   base_ttl = 86400  # 24 hours
   jitter = random(-3600, 3600)  # Â±1 hour
   ttl = base_ttl + jitter

2. Cache warming
   - Background refresh before midnight
   - Preload DB query 1 hour before expiry

3. Stale-While-Revalidate
   - Serve stale cache while async refresh

4. Distribute cache refresh
   - Cache items at different times
```

### Problem 4 Answer

```
a) Static image (versioned)
   Cache-Control: public, max-age=31536000, immutable

b) API response
   Cache-Control: public, max-age=60, s-maxage=600

c) Login status API
   Cache-Control: no-store
   (or: Cache-Control: private, no-cache)
```

---

## 7. Next Steps

If you've understood caching strategies, learn about distributed cache systems next.

### Next Lesson
- [07_Distributed_Cache_Systems.md](./07_Distributed_Cache_Systems.md)

### Related Lessons
- [05_Reverse_Proxy_API_Gateway.md](./05_Reverse_Proxy_API_Gateway.md) - Proxy caching

### Recommended Practice
1. Implement cache patterns in Redis
2. Practice Nginx caching configuration
3. Test Cache-Control headers

---

## 8. References

### Documentation
- [Redis Caching](https://redis.io/docs/manual/client-side-caching/)
- [HTTP Caching - MDN](https://developer.mozilla.org/en-US/docs/Web/HTTP/Caching)
- [Cloudflare Cache](https://developers.cloudflare.com/cache/)

### Tools
- [Redis](https://redis.io/)
- [Memcached](https://memcached.org/)
- [Varnish Cache](https://varnish-cache.org/)

### References
- [Caching Strategies](https://aws.amazon.com/caching/best-practices/)

---

**Document Information**
- Last Modified: 2024
- Difficulty: â­â­â­
- Estimated Learning Time: 2-3 hours
