# IPv6

## 학습 목표
- IPv6의 필요성과 IPv4의 한계 이해하기
- IPv6 주소 형식, 표기법, 유형 마스터하기
- IPv6 헤더 구조와 IPv4 대비 개선사항 학습하기
- 주소 자동 구성 메커니즘(SLAAC, DHCPv6) 이해하기
- 인접 탐색 프로토콜(NDP)과 역할 학습하기
- IPv4에서 IPv6로의 전환 메커니즘 탐구하기
- IPv6 라우팅 프로토콜 이해하기
- IPv6 보안 고려사항 학습하기
- IPv6 네트워크 구성 및 문제 해결하기

## 목차
1. [왜 IPv6인가?](#1-왜-ipv6인가)
2. [IPv6 주소 형식](#2-ipv6-주소-형식)
3. [IPv6 주소 유형](#3-ipv6-주소-유형)
4. [IPv6 헤더](#4-ipv6-헤더)
5. [주소 자동 구성](#5-주소-자동-구성)
6. [인접 탐색 프로토콜](#6-인접-탐색-프로토콜)
7. [전환 메커니즘](#7-전환-메커니즘)
8. [IPv6 라우팅](#8-ipv6-라우팅)
9. [IPv6 보안](#9-ipv6-보안)
10. [실전 구성](#10-실전-구성)
11. [연습 문제](#11-연습-문제)

---

## 1. 왜 IPv6인가?

### IPv4 고갈

IPv4는 32비트 주소를 사용하여 약 43억 개의 주소를 제공합니다:

```
Total IPv4 addresses = 2^32 = 4,294,967,296
```

**고갈 타임라인:**
- 2011: IANA 중앙 풀 고갈
- 2015: ARIN (북미) 고갈
- 2019: RIPE NCC (유럽) 고갈
- 2021: 모든 지역 인터넷 레지스트리(RIRs) 고갈

### NAT의 한계

네트워크 주소 변환(NAT)은 임시 해결책이었습니다:

**NAT의 단점:**
- End-to-end 연결성 파괴
- P2P 애플리케이션 복잡화
- 처리 오버헤드 추가
- 문제 해결 어려움
- 일부 프로토콜과 호환 불가(IPsec, SIP)

### IPv6의 장점

**대규모 주소 공간:**
```
IPv6 addresses = 2^128 ≈ 3.4 × 10^38 addresses
```

**기타 이점:**
- NAT 불필요(End-to-end 연결성 복원)
- 빠른 처리를 위한 간소화된 헤더
- 내장 IPsec 지원
- 향상된 멀티캐스트 지원
- 자동 구성(SLAAC)
- 브로드캐스트 없음(멀티캐스트로 대체)
- 플로우 레이블을 통한 향상된 QoS

---

## 2. IPv6 주소 형식

### 128비트 주소 구조

IPv6 주소는 128비트 길이로, 4자리 16진수 8그룹으로 표기합니다:

```
IPv6 Address Structure:
┌────────────────────────────────────────────────────────────────┐
│  16 bits │  16 bits │  16 bits │  16 bits │ ... │  16 bits   │
│  (0-FFFF)│  (0-FFFF)│  (0-FFFF)│  (0-FFFF)│ ... │  (0-FFFF)  │
└────────────────────────────────────────────────────────────────┘
   Group 1    Group 2    Group 3    Group 4   ...    Group 8

Example:
2001:0db8:85a3:0000:0000:8a2e:0370:7334
```

### 표기 규칙

**전체 표기법:**
```
2001:0db8:0000:0042:0000:8a2e:0370:7334
```

**규칙 1: 앞의 0은 생략 가능**
```
2001:db8:0:42:0:8a2e:370:7334
```

**규칙 2: 연속된 0 그룹은 `::`로 대체 가능**
```
2001:db8:0:42::8a2e:370:7334
```

**중요: `::`는 주소당 한 번만 사용 가능**

```
# Valid
2001:db8::1
ff02::1
::1 (loopback)

# Invalid (multiple ::)
2001::25de::cade  # ❌ Ambiguous
```

### 주소 단축 예제

```
Original:   2001:0db8:0000:0000:0000:0000:0000:0001
Shortened:  2001:db8::1

Original:   fe80:0000:0000:0000:0202:b3ff:fe1e:8329
Shortened:  fe80::202:b3ff:fe1e:8329

Original:   0000:0000:0000:0000:0000:0000:0000:0001
Shortest:   ::1 (loopback)

Original:   0000:0000:0000:0000:0000:0000:0000:0000
Shortest:   :: (unspecified address)
```

### 프리픽스 표기법

IPv4의 CIDR과 유사:

```
2001:db8:abcd:0012::/64
             └─────────┘
             Network prefix (64 bits)
```

---

## 3. IPv6 주소 유형

### 유니캐스트 주소(Unicast Addresses)

#### 글로벌 유니캐스트(Global Unicast, GUA)
인터넷에서 라우팅 가능(공인 IPv4와 동등):

```
Address Range: 2000::/3 (currently 2000:: to 3fff::)

Structure:
┌──────────────┬──────────────┬──────────────┬──────────────┐
│   Global     │   Subnet ID  │  Interface   │              │
│   Routing    │              │  Identifier  │              │
│   Prefix     │              │  (IID)       │              │
│  (48 bits)   │  (16 bits)   │  (64 bits)   │              │
└──────────────┴──────────────┴──────────────┴──────────────┘

Example:
2001:db8:1234:5678::1/64
└───────────┘ └──┘ └──────┘
    ISP      Subnet  Host
```

#### 링크-로컬 주소(Link-Local Addresses, LLA)
로컬 링크에서만 유효(IPv4의 169.254.x.x와 유사):

```
Address Range: fe80::/10

Structure:
┌───────┬────────┬────────────────────────────┐
│ fe80  │  0000  │  Interface ID (64 bits)    │
└───────┴────────┴────────────────────────────┘

Example:
fe80::1
fe80::202:b3ff:fe1e:8329
```

**모든 IPv6 인터페이스에 필수!**

#### 고유 로컬 주소(Unique Local Addresses, ULA)
사설 주소(IPv4의 10.x.x.x, 192.168.x.x와 유사):

```
Address Range: fc00::/7 (fd00::/8 in practice)

Structure:
┌────┬───┬────────────┬────────┬──────────────┐
│ fd │ 0 │ Global ID  │ Subnet │ Interface ID │
│    │   │ (40 bits)  │(16 bit)│  (64 bits)   │
└────┴───┴────────────┴────────┴──────────────┘

Example:
fd00:1234:5678:1::1/64
```

### 멀티캐스트 주소(Multicast Addresses)

```
Address Range: ff00::/8

Structure:
┌────┬───────┬──────────────────────┐
│ ff │ Flags │    Group ID          │
│    │ Scope │                      │
└────┴───────┴──────────────────────┘

Common multicast addresses:
ff02::1         All nodes on link
ff02::2         All routers on link
ff02::1:ff00:0/104  Solicited-node multicast
```

**스코프(Scopes):**
- `1` - Interface-local
- `2` - Link-local
- `5` - Site-local
- `8` - Organization-local
- `e` - Global

### 애니캐스트 주소(Anycast Addresses)

유니캐스트와 동일한 형식이지만 여러 인터페이스에 할당됩니다. 패킷은 가장 가까운 인터페이스로 전달됩니다.

```
Example use case: DNS root servers
2001:db8::1 assigned to multiple servers
```

### 특수 주소(Special Addresses)

```
::1/128         Loopback (localhost)
::/128          Unspecified address (like 0.0.0.0)
::ffff:0:0/96   IPv4-mapped IPv6 (::ffff:192.0.2.1)
2001:db8::/32   Documentation prefix
```

---

## 4. IPv6 헤더

### 간소화된 헤더 구조

IPv6 헤더는 더 간단하며 고정 길이(40바이트)입니다:

```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|Version| Traffic Class |           Flow Label                  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         Payload Length        |  Next Header  |   Hop Limit   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                                                               +
|                                                               |
+                         Source Address                        +
|                                                               |
+                                                               +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                                                               +
|                                                               |
+                      Destination Address                      +
|                                                               |
+                                                               +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

### 필드 설명

| 필드 | 크기 | 설명 |
|-------|------|-------------|
| Version | 4 bits | 항상 6 |
| Traffic Class | 8 bits | QoS 우선순위 (IPv4의 DSCP와 유사) |
| Flow Label | 20 bits | QoS 플로우 식별 |
| Payload Length | 16 bits | 페이로드 길이 (헤더 제외) |
| Next Header | 8 bits | 다음 헤더 유형 (TCP=6, UDP=17 등) |
| Hop Limit | 8 bits | 각 라우터에서 감소 (TTL과 유사) |
| Source Address | 128 bits | 출발지 IPv6 주소 |
| Destination Address | 128 bits | 목적지 IPv6 주소 |

### IPv4 대비 개선사항

**제거된 필드:**
- Header Length (40바이트로 고정)
- Identification, Flags, Fragment Offset (확장 헤더로 이동)
- Header Checksum (링크 계층과 전송 계층에서 처리)

**이점:**
- 빠른 처리 (체크섬 계산 없음)
- 고정 헤더 크기 (하드웨어 구현 용이)
- 확장 헤더의 선택적 기능

### 확장 헤더(Extension Headers)

확장 헤더는 유연성을 제공합니다:

```
IPv6 Header → Ext Header 1 → Ext Header 2 → TCP/UDP Header → Data
```

**일반적인 확장 헤더:**
1. **Hop-by-Hop Options** (0) - 모든 노드에서 처리
2. **Routing** (43) - 소스 라우팅
3. **Fragment** (44) - 단편화 정보
4. **Destination Options** (60) - 목적지 옵션
5. **Authentication** (51) - IPsec AH
6. **Encapsulating Security Payload** (50) - IPsec ESP

**단편화 예제:**
```
┌─────────────┬──────────────┬──────────┬──────┐
│ IPv6 Header │  Fragment    │ TCP Hdr  │ Data │
│ Next=44     │  Header      │          │      │
│             │  Next=6      │          │      │
└─────────────┴──────────────┴──────────┴──────┘
```

---

## 5. 주소 자동 구성

### SLAAC (Stateless Address Autoconfiguration)

IPv6 장치는 DHCP 없이 스스로 구성할 수 있습니다:

```
Process:
┌──────────┐                           ┌──────────┐
│   Host   │                           │  Router  │
└────┬─────┘                           └────┬─────┘
     │                                      │
     │ 1. Generate link-local address       │
     │    (fe80::IID)                       │
     │                                      │
     │ 2. Router Solicitation (RS)          │
     │─────────────────────────────────────▶│
     │      (ICMPv6 type 133)               │
     │                                      │
     │ 3. Router Advertisement (RA)         │
     │◀─────────────────────────────────────│
     │      (prefix, gateway, flags)        │
     │      (ICMPv6 type 134)               │
     │                                      │
     │ 4. Generate global address           │
     │    (prefix + IID)                    │
     │                                      │
     │ 5. Duplicate Address Detection (DAD) │
     │    (Neighbor Solicitation)           │
     │─────────────────────────────────────▶│
     │                                      │
```

### 인터페이스 식별자(Interface Identifier, IID) 생성

**방법 1: EUI-64 (MAC 주소에서)**

```
MAC address:  00:1A:2B:3C:4D:5E

Steps:
1. Split MAC:     001A2B | 3C4D5E
2. Insert FFFE:   001A2B | FFFE | 3C4D5E
3. Flip U/L bit:  021A2B | FFFE | 3C4D5E
   (7th bit of first byte: 00 → 02)

Result IID: 021a:2bff:fe3c:4d5e
```

**방법 2: 프라이버시 확장(Privacy Extensions, RFC 4941)**

프라이버시를 위해 주기적으로 생성되는 랜덤 IID:

```
Temporary IID: 1234:5678:9abc:def0 (random)
Lifetime: 1 day (configurable)
```

### DHCPv6

**스테이트리스 DHCPv6(Stateless DHCPv6):**
- SLAAC로부터 주소
- DHCPv6로부터 DNS, NTP

**스테이트풀 DHCPv6(Stateful DHCPv6):**
- DHCPv6 서버로부터 전체 주소
- 전통적인 DHCP와 유사

**DHCPv6 프로세스:**
```
Client                              Server
  │                                   │
  │ SOLICIT (multicast ff02::1:2)    │
  │──────────────────────────────────▶│
  │                                   │
  │ ADVERTISE                         │
  │◀──────────────────────────────────│
  │                                   │
  │ REQUEST                           │
  │──────────────────────────────────▶│
  │                                   │
  │ REPLY (address, DNS, etc.)        │
  │◀──────────────────────────────────│
```

### 라우터 광고 플래그(Router Advertisement Flags)

```
M flag (Managed): 1 = Use DHCPv6 for address
O flag (Other):   1 = Use DHCPv6 for other config (DNS)

Combinations:
M=0, O=0  →  SLAAC only
M=0, O=1  →  SLAAC + stateless DHCPv6
M=1, O=0  →  Stateful DHCPv6
M=1, O=1  →  Stateful DHCPv6
```

---

## 6. 인접 탐색 프로토콜

### NDP vs ARP

NDP(Neighbor Discovery Protocol)는 IPv6에서 ARP를 대체합니다:

| 기능 | IPv4 | IPv6 |
|----------|------|------|
| 주소 해석 | ARP | NDP (NS/NA) |
| 라우터 발견 | ICMP Router Discovery | NDP (RS/RA) |
| 리다이렉트 | ICMP Redirect | NDP Redirect |
| MTU 발견 | - | NDP (RA) |

### NDP 메시지 유형

모든 NDP 메시지는 ICMPv6를 사용합니다:

1. **Router Solicitation (RS)** - Type 133
2. **Router Advertisement (RA)** - Type 134
3. **Neighbor Solicitation (NS)** - Type 135
4. **Neighbor Advertisement (NA)** - Type 136
5. **Redirect** - Type 137

### 인접 요청/광고(Neighbor Solicitation/Advertisement, NS/NA)

**주소 해석 예제:**

```
Host A wants to communicate with Host B (2001:db8::2)

1. Host A sends NS to solicited-node multicast:

   Src: 2001:db8::1
   Dst: ff02::1:ff00:2  (solicited-node for ::2)
   "Who has 2001:db8::2?"

2. Host B sends NA:

   Src: 2001:db8::2
   Dst: 2001:db8::1
   "I am 2001:db8::2, my MAC is 00:1A:2B:3C:4D:5E"
```

### 요청-노드 멀티캐스트(Solicited-Node Multicast)

효율적인 주소 해석:

```
Target address: 2001:db8::1234:5678

Solicited-node multicast:
ff02::1:ff34:5678
└──────┘ └────────┘
 prefix  last 24 bits
```

### 중복 주소 탐지(Duplicate Address Detection, DAD)

주소 사용 전:

```
1. Host sends NS for its own address:
   Src: :: (unspecified)
   Dst: ff02::1:ff00:1 (solicited-node)
   Target: 2001:db8::1 (tentative address)

2. If NA received → address conflict!
3. If no response → address is unique
```

### 인접 도달 불가 탐지(Neighbor Unreachability Detection, NUD)

이웃이 여전히 도달 가능한지 확인:

```
States:
INCOMPLETE → REACHABLE → STALE → DELAY → PROBE → UNREACHABLE

Transitions:
- REACHABLE: confirmation received within 30s
- STALE: no recent confirmation
- PROBE: sending NS to verify
```

---

## 7. 전환 메커니즘

### 이중 스택(Dual-Stack)

IPv4와 IPv6를 동시에 실행:

```
┌─────────────────────────────┐
│      Applications           │
└─────────────┬───────────────┘
              │
    ┌─────────┴─────────┐
    │                   │
┌───▼────┐        ┌────▼────┐
│  IPv4  │        │  IPv6   │
│  Stack │        │  Stack  │
└───┬────┘        └────┬────┘
    │                  │
    └──────────┬───────┘
               │
        ┌──────▼──────┐
        │   Network   │
        └─────────────┘
```

**구성 예제:**
```bash
# Linux interface with dual-stack
ip addr show eth0

eth0: <BROADCAST,MULTICAST,UP,LOWER_UP>
    inet 192.0.2.1/24
    inet6 2001:db8::1/64
    inet6 fe80::1/64 scope link
```

### 터널링 메커니즘(Tunneling Mechanisms)

#### 6to4 터널(6to4 Tunnel)

IPv4 인프라를 사용한 자동 터널링:

```
IPv6 Packet
    │
    ▼
┌───────────────┐
│  IPv4 Header  │
├───────────────┤
│  IPv6 Packet  │
└───────────────┘

6to4 address format:
2002:WWXX:YYZZ::/48
     └────────┘
     IPv4 address in hex

Example:
IPv4: 192.0.2.1 → C000:0201
6to4: 2002:c000:0201::/48
```

#### Teredo 터널(Teredo Tunnel)

IPv6를 위한 NAT 통과:

```
Structure:
┌────────┬─────────┬──────┬────────┬─────────┐
│  2001  │   0     │ IPv4 │  Flags │ Obscured│
│        │         │Server│        │ Client  │
└────────┴─────────┴──────┴────────┴─────────┘

Example:
2001:0000:4136:e378:8000:63bf:3fff:fdd2
          └────────┘      └──────────────┘
          Server IP       Client info
```

#### ISATAP

Intra-Site Automatic Tunnel Addressing Protocol:

```
Address format:
[prefix]:0:5efe:[IPv4 address]

Example:
2001:db8:1:2:0:5efe:192.0.2.1
                └──────────┘
                IPv4 address
```

### 변환 메커니즘(Translation Mechanisms)

#### NAT64/DNS64

IPv6 전용 클라이언트가 IPv4 서버에 접근 가능:

```
IPv6 Client                     IPv4 Server
2001:db8::1                     192.0.2.1
     │                               │
     │ 1. DNS query (AAAA)           │
     │─────────────▶DNS64            │
     │              │                │
     │              │ 2. No AAAA,    │
     │              │    query A     │
     │              │───────────────▶│
     │              │                │
     │              │ 3. A=192.0.2.1 │
     │              │◀───────────────│
     │              │                │
     │ 4. AAAA=     │                │
     │ 64:ff9b::    │                │
     │ c000:0201    │                │
     │◀─────────────│                │
     │                               │
     │ 5. Packet to                  │
     │ 64:ff9b::c000:0201            │
     │──────────▶NAT64───────────────▶│
     │              Translates to    │
     │              192.0.2.1        │
```

**Well-Known Prefix: 64:ff9b::/96**

---

## 8. IPv6 라우팅

### OSPFv3

IPv6용 OSPF:

```
Differences from OSPFv2:
- Runs directly over IPv6
- Link-local addresses for neighbor discovery
- Multiple instances per link
- Authentication via IPsec (not built-in)
```

**구성 예제 (Cisco):**
```
ipv6 router ospf 1
  router-id 1.1.1.1

interface GigabitEthernet0/0
  ipv6 ospf 1 area 0
  ipv6 address 2001:db8:1::1/64
```

### IPv6용 BGP

멀티 프로토콜 BGP (MP-BGP):

```
router bgp 65001
  neighbor 2001:db8::2 remote-as 65002

  address-family ipv6 unicast
    neighbor 2001:db8::2 activate
    network 2001:db8:1::/48
  exit-address-family
```

### 경로 집약(Route Aggregation)

IPv6의 대규모 주소 공간은 더 나은 집약을 가능하게 합니다:

```
ISP allocation: 2001:db8::/32

Customer subnets:
2001:db8:0001::/48
2001:db8:0002::/48
2001:db8:0003::/48
...
2001:db8:ffff::/48

Advertise only: 2001:db8::/32
```

### 라우팅 테이블 예제

```bash
# Linux routing table
ip -6 route show

2001:db8:1::/64 dev eth0 proto kernel metric 256
fe80::/64 dev eth0 proto kernel metric 256
default via fe80::1 dev eth0 metric 1024
```

---

## 9. IPv6 보안

### 내장 IPsec

IPv6는 IPsec을 염두에 두고 설계되었습니다:

```
┌────────────┬─────────┬─────────┬──────────┬──────┐
│ IPv6 Hdr   │ ESP Hdr │ TCP Hdr │   Data   │ ESP  │
│            │         │         │          │ Auth │
│ Next=50    │ Next=6  │         │(Encrypted)│      │
└────────────┴─────────┴─────────┴──────────┴──────┘
```

**참고:** IPsec은 실제로는 선택사항이지만 배포가 더 쉽습니다.

### 프라이버시 확장(Privacy Extensions)

안정적인 IID를 통한 추적 방지:

```bash
# Enable privacy extensions (Linux)
sysctl net.ipv6.conf.all.use_tempaddr=2

# Temporary address
2001:db8::1234:5678:9abc:def0  (changes daily)

# Stable address (for incoming connections)
2001:db8::21a:2bff:fe3c:4d5e   (EUI-64)
```

### 방화벽 고려사항

**중요:** 모든 ICMPv6를 차단하지 마세요!

```
Required ICMPv6 types:
- Type 1: Destination Unreachable
- Type 2: Packet Too Big (for PMTUD)
- Type 3: Time Exceeded
- Type 4: Parameter Problem
- Type 133-137: NDP messages
```

**예제 iptables:**
```bash
# Allow essential ICMPv6
ip6tables -A INPUT -p icmpv6 --icmpv6-type destination-unreachable -j ACCEPT
ip6tables -A INPUT -p icmpv6 --icmpv6-type packet-too-big -j ACCEPT
ip6tables -A INPUT -p icmpv6 --icmpv6-type time-exceeded -j ACCEPT
ip6tables -A INPUT -p icmpv6 --icmpv6-type parameter-problem -j ACCEPT

# Allow NDP
ip6tables -A INPUT -p icmpv6 --icmpv6-type router-advertisement -j ACCEPT
ip6tables -A INPUT -p icmpv6 --icmpv6-type router-solicitation -j ACCEPT
ip6tables -A INPUT -p icmpv6 --icmpv6-type neighbour-solicitation -j ACCEPT
ip6tables -A INPUT -p icmpv6 --icmpv6-type neighbour-advertisement -j ACCEPT
```

### 보안 위협

**악의적인 라우터 광고(Rogue Router Advertisements):**
- 공격자가 가짜 RA 전송
- 완화: RA Guard

**NDP 스푸핑(NDP Spoofing):**
- ARP 스푸핑과 유사
- 완화: SEcure Neighbor Discovery (SEND)

**주소 스캐닝(Address Scanning):**
- 대규모 서브넷으로 무차별 대입 공격 어려움
- 하지만 예측 가능한 IID(EUI-64)는 표적이 될 수 있음
- 완화: 프라이버시 확장 사용

---

## 10. 실전 구성

### Linux 구성

**IPv6 연결성 확인:**
```bash
# Show IPv6 addresses
ip -6 addr show

# Show IPv6 routes
ip -6 route show

# Ping IPv6 address
ping6 2001:4860:4860::8888

# Traceroute
traceroute6 google.com
```

**수동 주소 구성:**
```bash
# Add IPv6 address
sudo ip -6 addr add 2001:db8::1/64 dev eth0

# Add default route
sudo ip -6 route add default via fe80::1 dev eth0

# Enable IPv6 forwarding
sudo sysctl -w net.ipv6.conf.all.forwarding=1
```

**정적 구성 (Ubuntu/Debian):**
```yaml
# /etc/netplan/01-netcfg.yaml
network:
  version: 2
  ethernets:
    eth0:
      dhcp6: no
      addresses:
        - 2001:db8::1/64
      gateway6: fe80::1
      nameservers:
        addresses:
          - 2001:4860:4860::8888
          - 2001:4860:4860::8844
```

**SLAAC 활성화:**
```bash
# Accept Router Advertisements
sudo sysctl -w net.ipv6.conf.eth0.accept_ra=1

# Autoconf
sudo sysctl -w net.ipv6.conf.eth0.autoconf=1
```

### Windows 구성

**명령줄:**
```cmd
REM Show IPv6 configuration
ipconfig

REM Show IPv6 routing table
netsh interface ipv6 show route

REM Add static IPv6 address
netsh interface ipv6 add address "Ethernet" 2001:db8::1/64

REM Add default route
netsh interface ipv6 add route ::/0 "Ethernet" fe80::1

REM Test connectivity
ping 2001:4860:4860::8888
tracert google.com
```

**PowerShell:**
```powershell
# Get IPv6 configuration
Get-NetIPAddress -AddressFamily IPv6

# Add IPv6 address
New-NetIPAddress -InterfaceAlias "Ethernet" -IPAddress "2001:db8::1" -PrefixLength 64

# Add default route
New-NetRoute -DestinationPrefix "::/0" -InterfaceAlias "Ethernet" -NextHop "fe80::1"
```

### 연결성 테스트

**이중 스택 테스트:**
```bash
# IPv4 connectivity
ping google.com

# IPv6 connectivity
ping6 google.com

# Check which protocol is used
curl -v https://google.com
# Look for "Trying 2001:..." (IPv6) or "Trying 192..." (IPv4)

# Force IPv6
curl -6 https://google.com

# Force IPv4
curl -4 https://google.com
```

**온라인 테스트:**
- https://test-ipv6.com/
- https://ipv6-test.com/
- https://www.whatismyipv6.com/

### 일반적인 문제 및 해결

**IPv6 연결성 없음:**
```bash
# 1. Check if IPv6 is enabled
cat /proc/sys/net/ipv6/conf/all/disable_ipv6
# Should be 0 (enabled)

# 2. Check for IPv6 addresses
ip -6 addr show
# Should see link-local (fe80::) and possibly global

# 3. Check for default route
ip -6 route show
# Should see default via fe80::...

# 4. Check Router Advertisements
sudo rdisc6 eth0
# Should see RA from router

# 5. Test local connectivity
ping6 fe80::1%eth0  # Ping link-local gateway
```

**MTU 문제:**
```bash
# IPv6 minimum MTU is 1280 bytes
# Check current MTU
ip link show eth0

# Test PMTUD
ping6 -s 1500 2001:4860:4860::8888
```

---

## 11. 연습 문제

### 문제 1: 주소 단축
다음 IPv6 주소를 가장 짧은 형태로 단축하세요:

a) `2001:0db8:0000:0000:0000:0000:0000:0001`
b) `fe80:0000:0000:0000:0202:b3ff:fe1e:8329`
c) `2001:0db8:0001:0000:0000:0000:0000:0000`
d) `0000:0000:0000:0000:0000:0000:0000:0000`

**정답:**
```
a) 2001:db8::1
b) fe80::202:b3ff:fe1e:8329
c) 2001:db8:1::
d) ::
```

### 문제 2: EUI-64 변환
MAC 주소 `00:50:56:A1:B2:C3`가 주어졌을 때 계산하세요:
- EUI-64 인터페이스 식별자
- 완전한 링크-로컬 주소
- 프리픽스 `2001:db8:1::/64`를 가진 완전한 글로벌 주소

**정답:**
```
MAC: 00:50:56:A1:B2:C3

1. Split: 005056 | A1B2C3
2. Insert FFFE: 005056FFFE | A1B2C3
3. Flip 7th bit: 025056FFFE | A1B2C3

IID: 0250:56ff:fea1:b2c3

Link-local: fe80::250:56ff:fea1:b2c3
Global: 2001:db8:1::250:56ff:fea1:b2c3
```

### 문제 3: 서브넷팅
`2001:db8:abcd::/48`이 할당되었습니다. 다음을 위한 서브넷팅 방안을 설계하세요:
- 4개 지역 사무소 (각각 256개 서브넷 필요)
- 각 서브넷은 최종 사용자를 위한 /64 지원

**정답:**
```
/48 prefix: 2001:db8:abcd::/48

Use bits 49-52 for regions (4 bits = 16 regions):
Region 0: 2001:db8:abcd:0000::/52
Region 1: 2001:db8:abcd:1000::/52
Region 2: 2001:db8:abcd:2000::/52
Region 3: 2001:db8:abcd:3000::/52

Each /52 contains 4096 /64 subnets (2^12).

Region 0 examples:
2001:db8:abcd:0000::/64
2001:db8:abcd:0001::/64
2001:db8:abcd:0002::/64
...
2001:db8:abcd:0fff::/64
```

### 문제 4: NDP 분석
다음 경우의 NDP 메시지 순서를 설명하세요:
1. 호스트가 부팅되어 IPv6 연결성을 얻을 때
2. 호스트 A가 같은 링크의 호스트 B로 패킷을 보내려 할 때

**정답:**
```
1. Host boot sequence:
   a. Generate link-local address (fe80::IID)
   b. DAD: Send NS for own address
   c. If no NA, address is valid
   d. Send RS to ff02::2
   e. Receive RA with prefix, M/O flags
   f. Generate global address (prefix + IID)
   g. DAD for global address
   h. Optional: DHCPv6 if M=1 or O=1

2. Host A → Host B communication:
   a. Check neighbor cache for B's MAC
   b. If not found, send NS to B's solicited-node multicast
   c. Receive NA from B with MAC address
   d. Cache entry created (REACHABLE state)
   e. Send packet to B
```

### 문제 5: 전환 메커니즘 선택
각 시나리오에 가장 적합한 IPv6 전환 메커니즘을 추천하세요:

a) 이중 스택 라우터를 가진 기업, IPv4 백본을 통해 IPv6 아일랜드 연결 필요
b) NAT 뒤의 가정 사용자, IPv6 전용 서비스 사용
c) IPv6 전용 고객에게 IPv4 콘텐츠 제공하려는 ISP
d) IPv4만 제공하는 ISP를 사용하는 소규모 사무실, IPv6 원함

**정답:**
```
a) 6to4 or manual tunnels (GRE/IPsec)
   - Controlled environment, static config acceptable

b) Teredo
   - NAT traversal required
   - Automatic, no config needed

c) NAT64/DNS64
   - Translates IPv6 requests to IPv4
   - ISP-level deployment

d) 6to4 or Tunnel Broker (Hurricane Electric)
   - Automatic or semi-automatic
   - Works over any IPv4 connection
```

### 문제 6: 보안 구성
다음을 수행하는 ip6tables 규칙을 작성하세요:
- 확립된 연결 허용
- 필수 ICMPv6 허용
- 특정 프리픽스에서 SSH 허용
- 기타 모든 인바운드 트래픽 차단

**정답:**
```bash
#!/bin/bash
# Flush existing rules
ip6tables -F

# Default policy
ip6tables -P INPUT DROP
ip6tables -P FORWARD DROP
ip6tables -P OUTPUT ACCEPT

# Allow loopback
ip6tables -A INPUT -i lo -j ACCEPT

# Allow established/related
ip6tables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

# Allow essential ICMPv6
ip6tables -A INPUT -p icmpv6 --icmpv6-type destination-unreachable -j ACCEPT
ip6tables -A INPUT -p icmpv6 --icmpv6-type packet-too-big -j ACCEPT
ip6tables -A INPUT -p icmpv6 --icmpv6-type time-exceeded -j ACCEPT
ip6tables -A INPUT -p icmpv6 --icmpv6-type parameter-problem -j ACCEPT

# Allow NDP
ip6tables -A INPUT -p icmpv6 --icmpv6-type router-advertisement -j ACCEPT
ip6tables -A INPUT -p icmpv6 --icmpv6-type router-solicitation -j ACCEPT
ip6tables -A INPUT -p icmpv6 --icmpv6-type neighbour-solicitation -j ACCEPT
ip6tables -A INPUT -p icmpv6 --icmpv6-type neighbour-advertisement -j ACCEPT

# Allow SSH from 2001:db8::/32
ip6tables -A INPUT -p tcp --dport 22 -s 2001:db8::/32 -j ACCEPT

# Log dropped packets (optional)
ip6tables -A INPUT -j LOG --log-prefix "IPv6-DROP: "

# Drop everything else (already default policy)
```

---

## 요약

IPv6는 인터넷 주소 지정의 미래입니다:

**핵심 요점:**
1. **128비트 주소**는 사실상 무제한의 주소 공간 제공
2. **간소화된 헤더**는 라우팅 효율성 향상
3. **자동 구성(SLAAC)**은 구성 오버헤드 감소
4. **NDP**는 향상된 기능으로 ARP 대체
5. **전환 메커니즘**은 점진적 마이그레이션 가능
6. **내장 보안**은 IPsec 지원
7. **NAT 불필요**는 End-to-end 연결성 복원

**마이그레이션 전략:**
- 이중 스택으로 시작
- 모든 서비스가 IPv6 지원하는지 확인
- 필요에 따라 전환 메커니즘 사용
- IPv6 트래픽 증가 모니터링
- 최종적으로 IPv4 단계적 폐지

IPv6 채택이 증가하고 있으며, 이를 이해하는 것은 현대 네트워크 엔지니어링에 필수적입니다.

---

**난이도:** ⭐⭐⭐

**추가 읽을거리:**
- RFC 8200: IPv6 Specification
- RFC 4862: IPv6 Stateless Address Autoconfiguration
- RFC 4861: Neighbor Discovery for IPv6
- RFC 7084: Basic Requirements for IPv6 Customer Edge Routers

---

[이전: 17_Practical_Network_Tools](./17_Practical_Network_Tools.md) | [다음: 19_Container_Networking](./19_Container_Networking.md)
